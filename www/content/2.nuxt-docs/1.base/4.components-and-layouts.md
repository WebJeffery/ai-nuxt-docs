---
title: ç»„ä»¶ä¸å¸ƒå±€ç³»ç»Ÿ
description: æ·±å…¥æ¢è®¨ Nuxt æ¡†æ¶çš„ç»„ä»¶åŒ–å¼€å‘ä½“ç³»å’Œå¸ƒå±€ç³»ç»Ÿï¼ŒæŒæ¡ä¼ä¸šçº§åº”ç”¨çš„ç»„ä»¶è®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µ
icon: 'lucide:layout-template'
---

## æ¦‚è¿°

ç»„ä»¶åŒ–å¼€å‘æ˜¯ç°ä»£å‰ç«¯å¼€å‘çš„æ ¸å¿ƒç†å¿µï¼ŒNuxt æ¡†æ¶åœ¨ Vue.js çš„åŸºç¡€ä¸Šæä¾›äº†æ›´åŠ å®Œå–„çš„ç»„ä»¶åŒ–è§£å†³æ–¹æ¡ˆã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ Nuxt çš„ç»„ä»¶ç³»ç»Ÿå’Œå¸ƒå±€æœºåˆ¶ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡ä¼ä¸šçº§åº”ç”¨çš„ç»„ä»¶è®¾è®¡æ¨¡å¼ã€‚

### ğŸ¯ æ ¸å¿ƒç›®æ ‡

- æŒæ¡ Nuxt ç»„ä»¶ç³»ç»Ÿçš„å®Œæ•´å·¥ä½œæœºåˆ¶
- å­¦ä¹ ä¼ä¸šçº§ç»„ä»¶è®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µ
- ç†è§£å¸ƒå±€ç³»ç»Ÿçš„è®¾è®¡åŸç†å’Œåº”ç”¨åœºæ™¯
- æ„å»ºå¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç»„ä»¶åŒ–åº”ç”¨

### ğŸ’¡ æ ¸å¿ƒç‰¹æ€§

- **è‡ªåŠ¨å¯¼å…¥**: åŸºäºçº¦å®šçš„ç»„ä»¶è‡ªåŠ¨å‘ç°å’Œå¯¼å…¥æœºåˆ¶
- **æ™ºèƒ½ç¼“å­˜**: ç¼–è¯‘æ—¶ç»„ä»¶ä¾èµ–åˆ†æå’Œè¿è¡Œæ—¶ç¼“å­˜ä¼˜åŒ–
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹æ¨å¯¼å’ŒéªŒè¯
- **SSR å…¼å®¹**: å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ¸²æŸ“çš„æ— ç¼åˆ‡æ¢

## ç»„ä»¶åŸºç¡€

### ç»„ä»¶è‡ªåŠ¨å¯¼å…¥ä¸å‘½åè§„èŒƒ

Nuxt æä¾›äº†å¼ºå¤§çš„ç»„ä»¶è‡ªåŠ¨å¯¼å…¥åŠŸèƒ½ï¼Œå¤§å¤§ç®€åŒ–äº†ç»„ä»¶çš„ä½¿ç”¨æ–¹å¼ã€‚

#### è‡ªåŠ¨å¯¼å…¥æœºåˆ¶

::alert{icon="lucide:info" color="blue"}
**å·¥ä½œåŸç†**: Nuxt åœ¨ç¼–è¯‘æ—¶æ‰«æ `components/` ç›®å½•ï¼Œè‡ªåŠ¨ç”Ÿæˆç»„ä»¶æ˜ å°„è¡¨ï¼Œå¹¶åœ¨è¿è¡Œæ—¶æä¾›æŒ‰éœ€å¯¼å…¥åŠŸèƒ½ã€‚è¿™ç§æœºåˆ¶æ—¢æé«˜äº†å¼€å‘æ•ˆç‡ï¼Œåˆä¿è¯äº†åº”ç”¨çš„æ€§èƒ½ã€‚
::

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  components: {
    // å¼€å¯å…¨å±€ç»„ä»¶è‡ªåŠ¨å¯¼å…¥
    global: true,
    
    // é…ç½®ç»„ä»¶ç›®å½•æ‰«æè§„åˆ™
    dirs: [
      // 1ã€åŸºç¡€ç»„ä»¶ç›®å½•ï¼Œå…¨éƒ¨æ³¨å†Œä¸ºå…¨å±€ç»„ä»¶ï¼Œç»„ä»¶åå°†è‡ªåŠ¨æ˜ å°„ï¼Œå¦‚ Button.vue -> <Button>
      '~/components',
      
      // 2ã€UIç»„ä»¶ç›®å½•ï¼Œç»„ä»¶åå°†æ·»åŠ  Uiå‰ç¼€ï¼Œå¦‚ Button.vue -> <UiButton> 
      {
        path: '~/components/ui',
        prefix: 'Ui'
      },
      
      // 3ã€global å…¨å±€ç»„ä»¶ç›®å½•ï¼Œç»„ä»¶å°†æ³¨å†Œä¸ºå…¨å±€ç»„ä»¶, å¦‚ Header.vue -> <GlobalHeader>
      {
        path: '~/components/global',
        global: true,
        prefix: 'Global'
      },
      
      // 4ã€ä¸šåŠ¡ç»„ä»¶ç›®å½•ï¼ŒæŒ‰éœ€å¯¼å…¥ï¼Œå¦‚ UserCard.vue -> <BizUserCard>
      {
        path: '~/components/business',
        prefix: 'Biz',
        global: false
      }
    ]
  }
})
```

#### å‘½åè§„èŒƒä¸è·¯å¾„æ˜ å°„

ç»„ä»¶çš„å‘½åè§„èŒƒç›´æ¥å½±å“è‡ªåŠ¨å¯¼å…¥çš„æ•ˆæœå’Œä»£ç çš„å¯è¯»æ€§ã€‚

::card-group{cols=2}
  ::::card{icon="lucide:folder-tree" color="green"}
  #title
  **ç›®å½•ç»“æ„å‘½å**
  #description
  ```
  components/
  â”œâ”€â”€ ui/
  â”‚   â”œâ”€â”€ Button.vue          -> <UiButton>
  â”‚   â””â”€â”€ form/
  â”‚       â”œâ”€â”€ Input.vue       -> <UiFormInput>
  â”‚       â””â”€â”€ Select.vue      -> <UiFormSelect>
  â”œâ”€â”€ layout/
  â”‚   â”œâ”€â”€ Header.vue          -> <LayoutHeader>
  â”‚   â””â”€â”€ sidebar/
  â”‚       â””â”€â”€ Navigation.vue  -> <LayoutSidebarNavigation>
  â””â”€â”€ common/
      â”œâ”€â”€ Modal.vue           -> <CommonModal>
      â””â”€â”€ Toast.vue           -> <CommonToast>
  ```
  ::::

  ::::card{icon="lucide:file-text" color="blue"}
  #title
  **ç»„ä»¶åç§°è§„èŒƒ**
  #description
  - **PascalCase**: ç»„ä»¶æ–‡ä»¶åä½¿ç”¨å¤§é©¼å³°å‘½å
  - **è¯­ä¹‰åŒ–**: åç§°åæ˜ ç»„ä»¶çš„åŠŸèƒ½å’Œç”¨é€”
  - **å‰ç¼€å‘½å**: é€šè¿‡ç›®å½•ç»“æ„è‡ªåŠ¨ç”Ÿæˆå‰ç¼€
  - **é¿å…å†²çª**: ä½¿ç”¨æ˜ç¡®çš„å‘½åç©ºé—´é¿å…å†²çª
  ::::
::

#### é«˜çº§è‡ªåŠ¨å¯¼å…¥é…ç½®

å¯¹äºå¤§å‹åº”ç”¨ï¼Œéœ€è¦æ›´ç»†ç²’åº¦çš„è‡ªåŠ¨å¯¼å…¥æ§åˆ¶ï¼š

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  components: [
    {
      path: '~/components/ui',
      extensions: ['vue'],
      prefix: 'Ui',
      pathPrefix: false,
      global: true
    },
    {
      path: '~/components/business',
      prefix: 'Business',
      ignore: ['**/internal/**']  // å¿½ç•¥å†…éƒ¨ç»„ä»¶
    },
    {
      path: '~/components/icons',
      prefix: 'Icon',
      // è‡ªå®šä¹‰ç»„ä»¶åç§°è§£æ
      transform: (component) => {
        return component.pascalName.replace(/Icon$/, '')
      }
    }
  ]
})
```

### ç»„ä»¶ç›®å½•ç»“æ„

åˆç†çš„ç»„ä»¶ç›®å½•ç»“æ„æ˜¯é¡¹ç›®å¯ç»´æŠ¤æ€§çš„åŸºç¡€ã€‚

#### ä¼ä¸šçº§ç›®å½•ç»“æ„

```
components/
â”œâ”€â”€ ui/                      # åŸºç¡€UIç»„ä»¶
â”‚   â”œâ”€â”€ atoms/              # åŸå­çº§ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Button.vue
â”‚   â”‚   â”œâ”€â”€ Input.vue
â”‚   â”‚   â””â”€â”€ Icon.vue
â”‚   â”œâ”€â”€ molecules/          # åˆ†å­çº§ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ SearchBox.vue
â”‚   â”‚   â”œâ”€â”€ FormField.vue
â”‚   â”‚   â””â”€â”€ Card.vue
â”‚   â””â”€â”€ organisms/          # ç»„ç»‡çº§ç»„ä»¶
â”‚       â”œâ”€â”€ DataTable.vue
â”‚       â”œâ”€â”€ NavigationBar.vue
â”‚       â””â”€â”€ ProductList.vue
â”œâ”€â”€ business/               # ä¸šåŠ¡ç»„ä»¶
â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”œâ”€â”€ UserProfile.vue
â”‚   â”‚   â”œâ”€â”€ UserList.vue
â”‚   â”‚   â””â”€â”€ UserForm.vue
â”‚   â”œâ”€â”€ product/
â”‚   â”‚   â”œâ”€â”€ ProductCard.vue
â”‚   â”‚   â”œâ”€â”€ ProductDetail.vue
â”‚   â”‚   â””â”€â”€ ProductFilter.vue
â”‚   â””â”€â”€ order/
â”‚       â”œâ”€â”€ OrderSummary.vue
â”‚       â””â”€â”€ OrderHistory.vue
â”œâ”€â”€ layout/                 # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ AppHeader.vue
â”‚   â”œâ”€â”€ AppSidebar.vue
â”‚   â”œâ”€â”€ AppFooter.vue
â”‚   â””â”€â”€ AppMain.vue
â”œâ”€â”€ common/                 # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ Loading.vue
â”‚   â”œâ”€â”€ ErrorBoundary.vue
â”‚   â”œâ”€â”€ ConfirmDialog.vue
â”‚   â””â”€â”€ Toast.vue
â””â”€â”€ providers/              # æä¾›è€…ç»„ä»¶
    â”œâ”€â”€ ThemeProvider.vue
    â”œâ”€â”€ AuthProvider.vue
    â””â”€â”€ I18nProvider.vue
```

#### ç»„ä»¶æ–‡ä»¶ç»„ç»‡æ¨¡å¼

ç»„ä»¶æ–‡ä»¶ç»„ç»‡æ¨¡å¼çš„ä½œç”¨åœ¨äºæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§ã€‚é€šè¿‡åˆç†çš„ç»„ç»‡æ¨¡å¼ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿå®šä½å’Œç†è§£ç»„ä»¶çš„åŠŸèƒ½å’Œç”¨é€”ã€‚

ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ç»„ä»¶æ–‡ä»¶ç»„ç»‡æ¨¡å¼åŠå…¶ä½œç”¨ï¼š

1. **æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡**ï¼šå°†ç»„ä»¶æŒ‰åŠŸèƒ½æ¨¡å—è¿›è¡Œåˆ’åˆ†ï¼Œä¾‹å¦‚UIç»„ä»¶ã€ä¸šåŠ¡ç»„ä»¶ã€å¸ƒå±€ç»„ä»¶ç­‰ã€‚è¿™ç§æ–¹å¼æœ‰åŠ©äºå¼€å‘è€…å¿«é€Ÿæ‰¾åˆ°ç›¸å…³ç»„ä»¶ï¼Œå¹¶ä¸”åœ¨é¡¹ç›®è§„æ¨¡æ‰©å¤§æ—¶ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°ç®¡ç†å’Œæ‰©å±•ç»„ä»¶ã€‚

2. **æŒ‰ç»„ä»¶ç±»å‹ç»„ç»‡**ï¼šå°†ç»„ä»¶æŒ‰ç±»å‹è¿›è¡Œåˆ’åˆ†ï¼Œä¾‹å¦‚åŸå­çº§ç»„ä»¶ã€åˆ†å­çº§ç»„ä»¶ã€ç»„ç»‡çº§ç»„ä»¶ç­‰ã€‚è¿™ç§æ–¹å¼åŸºäºåŸå­è®¾è®¡åŸåˆ™ï¼Œæœ‰åŠ©äºå¼€å‘è€…ç†è§£ç»„ä»¶çš„å¤æ‚æ€§å’Œå¤ç”¨æ€§ï¼Œé¼“åŠ±ç»„ä»¶çš„å¤ç”¨å’Œç»„åˆã€‚

3. **æŒ‰é¡µé¢æˆ–ä¸šåŠ¡åŸŸç»„ç»‡**ï¼šå°†ç»„ä»¶æŒ‰é¡µé¢æˆ–ä¸šåŠ¡åŸŸè¿›è¡Œåˆ’åˆ†ï¼Œä¾‹å¦‚ç”¨æˆ·ç®¡ç†ã€äº§å“ç®¡ç†ç­‰ã€‚è¿™ç§æ–¹å¼æœ‰åŠ©äºå°†ç›¸å…³çš„ç»„ä»¶é›†ä¸­åœ¨ä¸€èµ·ï¼Œä¾¿äºä¸šåŠ¡é€»è¾‘çš„ç®¡ç†å’Œç»´æŠ¤ã€‚

é€šè¿‡è¿™äº›ç»„ç»‡æ¨¡å¼ï¼Œç»„ä»¶çš„ç»“æ„æ›´åŠ æ¸…æ™°ï¼Œå¼€å‘è€…å¯ä»¥æ›´é«˜æ•ˆåœ°è¿›è¡Œå¼€å‘å’Œç»´æŠ¤å·¥ä½œã€‚åŒæ—¶ï¼Œè¿™äº›æ¨¡å¼ä¹Ÿæœ‰åŠ©äºå›¢é˜Ÿåä½œï¼Œç¡®ä¿ä¸åŒå¼€å‘è€…ä¹‹é—´çš„ä»£ç é£æ ¼å’Œç»„ç»‡æ–¹å¼ä¸€è‡´ã€‚


### å…¨å±€ç»„ä»¶ä¸å±€éƒ¨ç»„ä»¶

#### å…¨å±€ç»„ä»¶ä½¿ç”¨

å…¨å±€ç»„ä»¶é€‚ç”¨äºæ•´ä¸ªåº”ç”¨ä¸­é¢‘ç¹ä½¿ç”¨çš„åŸºç¡€ç»„ä»¶ï¼Œé™¤äº†åœ¨ `nuxt.config.ts` ä¸­é…ç½® `components` æ³¨å†Œçš„å…¨å±€ç»„ä»¶å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ `æ’ä»¶æ–¹å¼` ä¸­æ³¨å†Œå…¨å±€ç»„ä»¶ã€‚

```typescript
// plugins/global-components.client.ts
export default defineNuxtPlugin((nuxtApp) => {
  // æ‰‹åŠ¨æ³¨å†Œå…¨å±€ç»„ä»¶
  nuxtApp.vueApp.component('GlobalButton', resolveComponent('UiButton'))
  nuxtApp.vueApp.component('GlobalModal', resolveComponent('CommonModal'))
  nuxtApp.vueApp.component('GlobalToast', resolveComponent('CommonToast'))
})
```

#### å±€éƒ¨ç»„ä»¶ä¼˜åŒ–

å¯¹äºç‰¹å®šåœºæ™¯çš„ç»„ä»¶ï¼Œä½¿ç”¨å±€éƒ¨å¯¼å…¥å¯ä»¥æé«˜æ€§èƒ½ï¼š

```vue
<script setup lang="ts">
// æ˜¾å¼å¯¼å…¥å±€éƒ¨ç»„ä»¶
import UserProfileCard from '~/components/business/user/UserProfileCard.vue'
import ProductDetailModal from '~/components/business/product/ProductDetailModal.vue'

// æ¡ä»¶å¯¼å…¥
const showAdvancedFilter = ref(false)
const AdvancedFilter = showAdvancedFilter.value 
  ? defineAsyncComponent(() => import('~/components/business/product/AdvancedFilter.vue'))
  : null
</script>
```

#### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

::alert{icon="lucide:zap" color="green"}
**æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š
1. **åŸºç¡€ç»„ä»¶å…¨å±€åŒ–**: Buttonã€Inputã€Icon ç­‰åŸºç¡€ç»„ä»¶è®¾ä¸ºå…¨å±€
2. **ä¸šåŠ¡ç»„ä»¶å±€éƒ¨åŒ–**: ç‰¹å®šä¸šåŠ¡é€»è¾‘çš„ç»„ä»¶ä½¿ç”¨å±€éƒ¨å¯¼å…¥
3. **æ¡ä»¶å¯¼å…¥**: å¤§å‹ç»„ä»¶ä½¿ç”¨ `defineAsyncComponent` å®ç°æ‡’åŠ è½½
4. **TreeShaking**: ç¡®ä¿æœªä½¿ç”¨çš„ç»„ä»¶ä¸ä¼šè¢«æ‰“åŒ…
::

### ç»„ä»¶åº“é›†æˆ

#### ä¸»æµç»„ä»¶åº“é›†æˆ

::card-group{cols=2}
  ::::card{icon="lucide:palette" color="blue"}
  #title
  **Element Plus**
  #description
  ```bash
  npm install element-plus
  npm install @element-plus/nuxt
  ```
  
  ```typescript
  // nuxt.config.ts
  export default defineNuxtConfig({
    modules: ['@element-plus/nuxt'],
    elementPlus: {
      importStyle: 'scss'
    }
  })
  ```
  ::::

  ::::card{icon="lucide:component" color="green"}
  #title
  **Ant Design Vue**
  #description
  ```bash
  npm install ant-design-vue
  ```
  
  ```typescript
  // plugins/antd.client.ts
  import Antd from 'ant-design-vue'
  import 'ant-design-vue/dist/reset.css'
  
  export default defineNuxtPlugin((nuxtApp) => {
    nuxtApp.vueApp.use(Antd)
  })
  ```
  ::::
::

#### è‡ªå®šä¹‰ç»„ä»¶åº“å¼€å‘

æ„å»ºä¼ä¸šçº§ç»„ä»¶åº“çš„æœ€ä½³å®è·µï¼š

```typescript
// composables/useComponentLibrary.ts
export const useComponentLibrary = () => {
  const theme = ref('default')
  const locale = ref('zh-CN')
  
  const components = {
    // åŸºç¡€ç»„ä»¶
    button: () => import('~/components/ui/Button.vue'),
    input: () => import('~/components/ui/Input.vue'),
    modal: () => import('~/components/ui/Modal.vue'),
    
    // å¤åˆç»„ä»¶
    dataTable: () => import('~/components/ui/DataTable/index.vue'),
    form: () => import('~/components/ui/Form/index.vue'),
    
    // ä¸šåŠ¡ç»„ä»¶
    userCard: () => import('~/components/business/UserCard.vue'),
    productList: () => import('~/components/business/ProductList.vue')
  }
  
  const registerComponent = (name: string, component: any) => {
    components[name] = component
  }
  
  const getComponent = (name: string) => {
    return components[name]
  }
  
  return {
    theme,
    locale,
    components,
    registerComponent,
    getComponent
  }
}
```

### å®¢æˆ·ç«¯ä¸“å±ç»„ä»¶ä¸SSRå…¼å®¹æ€§

#### å®¢æˆ·ç«¯ç»„ä»¶å¤„ç†

æŸäº›ç»„ä»¶åªèƒ½åœ¨å®¢æˆ·ç«¯è¿è¡Œï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ï¼š

```vue
<template>
  <div>
    <h1>æœåŠ¡ç«¯æ¸²æŸ“å†…å®¹</h1>
    
    <!-- å®¢æˆ·ç«¯ä¸“å±ç»„ä»¶ -->
    <ClientOnly>
      <MapComponent :markers="markers" />
      <template #fallback>
        <div class="loading">åŠ è½½åœ°å›¾ä¸­...</div>
      </template>
    </ClientOnly>
    
    <!-- æ¡ä»¶æ¸²æŸ“å®¢æˆ·ç«¯ç»„ä»¶ -->
    <WebRTCComponent v-if="$client" />
  </div>
</template>

<script setup lang="ts">
import MapComponent from '~/components/client/MapComponent.vue'
import WebRTCComponent from '~/components/client/WebRTCComponent.vue'

const markers = ref([])
</script>
```

#### SSR å…¼å®¹æ€§è®¾è®¡

åœ¨è®¾è®¡SSRå…¼å®¹çš„ç»„ä»¶æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å› ç´ ï¼š

1. **çŠ¶æ€åŒæ­¥**: ç¡®ä¿ç»„ä»¶åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„çŠ¶æ€ä¸€è‡´æ€§ã€‚

2. **ç”Ÿå‘½å‘¨æœŸé’©å­**: äº†è§£å“ªäº›ç”Ÿå‘½å‘¨æœŸé’©å­åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œ`onMounted` åªåœ¨å®¢æˆ·ç«¯æ‰§è¡Œï¼Œå› æ­¤é€‚åˆæ”¾ç½®ä»…åœ¨å®¢æˆ·ç«¯è¿è¡Œçš„é€»è¾‘ã€‚

3. **å®¢æˆ·ç«¯ä¸“å±é€»è¾‘**: å°†ä»…åœ¨å®¢æˆ·ç«¯æ‰§è¡Œçš„é€»è¾‘æ”¾åœ¨ `process.client` åˆ¤æ–­ä¸­ï¼Œé¿å…åœ¨æœåŠ¡ç«¯æ‰§è¡Œä¸å¿…è¦çš„æ“ä½œã€‚

4. **å¤–éƒ¨ä¾èµ–**: ç¡®ä¿æ‰€æœ‰å¤–éƒ¨ä¾èµ–ï¼ˆå¦‚æµè§ˆå™¨APIï¼‰åœ¨æœåŠ¡ç«¯ç¯å¢ƒä¸­ä¸ä¼šè¢«è°ƒç”¨ï¼Œé¿å…é”™è¯¯ã€‚

5. **æ€§èƒ½ä¼˜åŒ–**: åœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼Œå°½é‡å‡å°‘ä¸å¿…è¦çš„è®¡ç®—å’Œæ•°æ®è¯·æ±‚ï¼Œä»¥æé«˜æ¸²æŸ“æ€§èƒ½ã€‚

6. **æ•°æ®æŒä¹…åŒ–**: ä½¿ç”¨ `localStorage` æˆ– `sessionStorage` ç­‰æµè§ˆå™¨å­˜å‚¨æ—¶ï¼Œç¡®ä¿è¿™äº›æ“ä½œä»…åœ¨å®¢æˆ·ç«¯æ‰§è¡Œã€‚

7. **é”™è¯¯å¤„ç†**: åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½éœ€è¦æœ‰è‰¯å¥½çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä»¥ç¡®ä¿åº”ç”¨çš„ç¨³å®šæ€§ã€‚

é€šè¿‡è€ƒè™‘ä»¥ä¸Šå› ç´ ï¼Œå¯ä»¥è®¾è®¡å‡ºé«˜æ•ˆä¸”ç¨³å®šçš„SSRå…¼å®¹ç»„ä»¶ã€‚


::code-group
  ::::code-block{label="SSRå…¼å®¹ç»„ä»¶" language="vue"}
  ```vue
  <!-- components/common/ThemeToggle.vue -->
  <template>
    <button 
      :class="buttonClasses"
      @click="toggleTheme"
      :aria-label="currentTheme === 'dark' ? 'åˆ‡æ¢åˆ°äº®è‰²æ¨¡å¼' : 'åˆ‡æ¢åˆ°æš—è‰²æ¨¡å¼'"
    >
      <Icon :name="currentTheme === 'dark' ? 'sun' : 'moon'" />
    </button>
  </template>

  <script setup lang="ts">
  // ä½¿ç”¨ useState ç¡®ä¿æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çŠ¶æ€åŒæ­¥
  const currentTheme = ref('light')
  
  const buttonClasses = computed(() => [
    'theme-toggle',
    `theme-toggle--${currentTheme.value}`
  ])
  
  const toggleTheme = () => {
    currentTheme.value = currentTheme.value === 'dark' ? 'light' : 'dark'
    
    // å®¢æˆ·ç«¯æ‰æ‰§è¡Œ DOM æ“ä½œ
    if (process.client) {
      document.documentElement.classList.toggle('dark', currentTheme.value === 'dark')
    }
  }
  
  // å®¢æˆ·ç«¯æŒ‚è½½æ—¶åŒæ­¥ä¸»é¢˜
  onMounted(() => {
    const savedTheme = localStorage.getItem('theme')
    if (savedTheme) {
      currentTheme.value = savedTheme
      document.documentElement.classList.toggle('dark', savedTheme === 'dark')
    }
  })
  
  // ç›‘å¬ä¸»é¢˜å˜åŒ–
  watch(currentTheme, (newTheme) => {
    if (process.client) {
      localStorage.setItem('theme', newTheme)
    }
  })
  </script>
  ```
  ::::

  ::::code-block{label="æ°´åˆé”™è¯¯å¤„ç†" language="vue"}
  ```vue
  <!-- components/common/ClientOnlyWrapper.vue -->
  <template>
    <div class="client-wrapper">
      <div v-if="!hydrated" class="ssr-fallback">
        <slot name="fallback">
          <div class="loading-skeleton">
            <div class="skeleton-line"></div>
            <div class="skeleton-line"></div>
            <div class="skeleton-line"></div>
          </div>
        </slot>
      </div>
      
      <div v-else class="hydrated-content">
        <slot />
      </div>
    </div>
  </template>

  <script setup lang="ts">
  const hydrated = ref(false)
  
  onMounted(() => {
    // é˜²æ­¢æ°´åˆé”™è¯¯
    nextTick(() => {
      hydrated.value = true
    })
  })
  </script>

  <style scoped>
  .loading-skeleton {
    @apply animate-pulse space-y-2;
  }
  
  .skeleton-line {
    @apply h-4 bg-gray-300 rounded;
  }
  
  .skeleton-line:nth-child(1) { @apply w-3/4; }
  .skeleton-line:nth-child(2) { @apply w-1/2; }
  .skeleton-line:nth-child(3) { @apply w-2/3; }
  </style>
  ```
  ::::
::

#### ç»„ä»¶çŠ¶æ€ç®¡ç†

åœ¨SSRç¯å¢ƒä¸­ç®¡ç†ç»„ä»¶çŠ¶æ€éœ€è¦ç‰¹åˆ«æ³¨æ„çŠ¶æ€çš„åˆå§‹åŒ–å’ŒåŒæ­¥ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æœ€ä½³å®è·µï¼š

1. ä½¿ç”¨ `useState` è¿›è¡ŒçŠ¶æ€ç®¡ç†

Nuxt æä¾›äº† `useState` é’©å­æ¥ç®¡ç†ç»„ä»¶çŠ¶æ€ï¼Œå®ƒåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½èƒ½ä¿æŒä¸€è‡´ã€‚
`const count = useState<number>('count', () => 0)`

2. åœ¨ `onServerPrefetch` ä¸­åˆå§‹åŒ–æ•°æ®

åœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼Œä½¿ç”¨ `onServerPrefetch` é’©å­æ¥é¢„å–æ•°æ®å¹¶åˆå§‹åŒ–çŠ¶æ€ã€‚
```ts
onServerPrefetch(async () => {
  const data = await fetchDataFromAPI()
  count.value = data.initialCount
})
```

3. ä½¿ç”¨ `useAsyncData` è¿›è¡Œæ•°æ®è·å–

`useAsyncData` æ˜¯ Nuxt æä¾›çš„ç”¨äºå¼‚æ­¥æ•°æ®è·å–çš„ç»„åˆå¼APIï¼Œæ”¯æŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æ•°æ®åŒæ­¥ã€‚
`const { data, pending, error } = useAsyncData('fetchData', () => $fetch('/api/data'))`







## ç»„ä»¶é€šä¿¡æœºåˆ¶

### Props ç»„ä»¶é€šä¿¡

#### Props åŸºæœ¬ä½¿ç”¨

Props æ˜¯ä¸€ç§å•å‘æ•°æ®æµï¼Œçˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’æ•°æ®ï¼Œå­ç»„ä»¶ä¸èƒ½å‘çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®ã€‚


1. **åŸºç¡€ Props ä¼ é€’**:
   - çˆ¶ç»„ä»¶é€šè¿‡åœ¨å­ç»„ä»¶æ ‡ç­¾ä¸Šä½¿ç”¨å±æ€§çš„æ–¹å¼ä¼ é€’æ•°æ®ã€‚
   - å­ç»„ä»¶é€šè¿‡ `defineProps` æ¥æ”¶è¿™äº›æ•°æ®ï¼Œå¹¶å¯ä»¥å¯¹å…¶è¿›è¡Œç±»å‹å®šä¹‰å’Œé»˜è®¤å€¼è®¾ç½®ã€‚

   ```vue
   <!-- çˆ¶ç»„ä»¶ -->
   <template>
     <UserCard :user="userData" :showActions="true" />
   </template>

   <script setup lang="ts">
   import UserCard from './UserCard.vue'

   const userData = reactive({
     name: 'å¼ ä¸‰',
     email: 'zhangsan@example.com',
     avatar: '/path/to/avatar.jpg',
     badges: [
       { id: 1, variant: 'success', text: 'VIP' }
     ]
   })
   </script>
   ```

   ```vue
   <!-- å­ç»„ä»¶ -->
   <script setup lang="ts">
   interface User {
     name: string
     email: string
     avatar?: string
     badges: Array<{ id: number, variant: string, text: string }>
   }

   const props = defineProps<{
     user: User
     showActions: boolean
   }>()
   </script>
   ```

2. **é»˜è®¤å€¼ä¸ç±»å‹éªŒè¯**:
   - ä½¿ç”¨ `withDefaults` ä¸º Props è®¾ç½®é»˜è®¤å€¼ã€‚
   - ä½¿ç”¨ TypeScript æ¥å£å®šä¹‰ Props çš„ç±»å‹ï¼Œç¡®ä¿ç±»å‹å®‰å…¨ã€‚

   ```ts
   const props = withDefaults(defineProps<{
     user: User
     showActions?: boolean
   }>(), {
     showActions: false
   })
   ```

3. **åŠ¨æ€ Props**:
   - ä½¿ç”¨ `v-bind` åŠ¨æ€ç»‘å®šå¯¹è±¡ä½œä¸º Propsï¼Œé€‚ç”¨äºéœ€è¦ä¼ é€’å¤šä¸ªå±æ€§çš„åœºæ™¯ã€‚

   ```vue
   <UserCard v-bind="userProps" />
   ```

   ```ts
   const userProps = reactive({
     user: userData,
     showActions: true
   })
   ```

4. **Prop å˜æ›´ç›‘å¬**:
   - ä½¿ç”¨ `watch` ç›‘å¬ Props çš„å˜åŒ–ï¼Œé€‚ç”¨äºéœ€è¦å¯¹ Props å˜åŒ–åšå‡ºå“åº”çš„åœºæ™¯ã€‚

   ```ts
   watch(() => props.user, (newUser, oldUser) => {
     console.log('ç”¨æˆ·ä¿¡æ¯æ›´æ–°:', newUser)
   })
   ```


#### Props æ€§èƒ½ä¼˜åŒ–


1. **é¿å…ä¸å¿…è¦çš„å“åº”å¼**:
   - ä½¿ç”¨ `shallowRef` æˆ– `shallowReactive` æ¥é¿å…æ·±åº¦å“åº”å¼ï¼Œå‡å°‘æ€§èƒ½å¼€é”€ã€‚
   - å¯¹äºä¸éœ€è¦å“åº”å¼çš„æ•°æ®ï¼Œä½¿ç”¨ `markRaw` æ ‡è®°ä¸ºéå“åº”å¼ã€‚

   ```ts
   // ä½¿ç”¨ shallowRef é¿å…æ·±å±‚å“åº”å¼
   const userConfig = shallowRef({
     theme: 'dark',
     settings: { notifications: true }
   })

   // ä½¿ç”¨ markRaw æ ‡è®°é™æ€æ•°æ®
   const staticData = markRaw({
     version: '1.0.0',
     constants: { MAX_SIZE: 100 }
   })
   ```

2. **ä½¿ç”¨ `readonly`**:
   - å¯¹äºä¸éœ€è¦ä¿®æ”¹çš„ Propsï¼Œä½¿ç”¨ `readonly` åŒ…è£…ï¼Œé˜²æ­¢æ„å¤–ä¿®æ”¹ï¼Œæé«˜å®‰å…¨æ€§ã€‚

   ```ts
   const props = readonly({
     user: { id: 1, name: 'Alice' },
     permissions: ['read', 'write']
   })
   ```

3. **æ·±åº¦å†»ç»“å¯¹è±¡**:
   - ä½¿ç”¨ `Object.freeze` æ·±åº¦å†»ç»“å¯¹è±¡ï¼Œç¡®ä¿å¯¹è±¡çš„ä¸å¯å˜æ€§ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚

   ```ts
   const frozenConfig = Object.freeze({
     api: {
       baseURL: 'https://api.example.com',
       timeout: 5000
     }
   })
   ```

4. **åˆç†ä½¿ç”¨ `watch`**:
   - ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨ `watch` ç›‘å¬ Props å˜åŒ–ï¼Œé¿å…è¿‡å¤šçš„å‰¯ä½œç”¨å‡½æ•°å½±å“æ€§èƒ½ã€‚

   ```ts
   // ä»…ç›‘å¬å¿…è¦çš„å±æ€§å˜åŒ–
   watch(() => props.user.id, (newId) => {
     // æ‰§è¡Œå¿…è¦çš„æ›´æ–°æ“ä½œ
     loadUserDetails(newId)
   })
   ```

5. **é¿å…è¿‡åº¦è§£æ„**:
   - åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ Props æ—¶ï¼Œå°½é‡é¿å…è§£æ„ï¼Œä»¥ç¡®ä¿ Vue èƒ½å¤Ÿæ­£ç¡®è¿½è¸ªä¾èµ–å…³ç³»ã€‚

   ```vue
   <!-- æ¨è -->
   <template>
     <div>{{ props.user.name }}</div>
   </template>

   <!-- ä¸æ¨è -->
   <template>
     <div>{{ name }}</div>
   </template>
   ```

6. **ä½¿ç”¨ç»„åˆå¼ API**:
   - åˆ©ç”¨ç»„åˆå¼ API çš„çµæ´»æ€§ï¼ŒæŒ‰éœ€ä¼˜åŒ– Props çš„å“åº”å¼è¡Œä¸ºã€‚

   ```ts
   const { user, settings } = toRefs(props)
   const userDisplayName = computed(() => {
     return `${user.value.firstName} ${user.value.lastName}`
   })
   ```

7. **æŒ‰éœ€å¯¼å…¥**:
   - å¯¹äºå¤§å‹ç»„ä»¶ï¼ŒæŒ‰éœ€å¯¼å…¥å’Œä½¿ç”¨ Propsï¼Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®—å’Œæ¸²æŸ“ã€‚

   ```ts
   // æŒ‰éœ€å¯¼å…¥å¿…è¦çš„å±æ€§
   const { name, avatar } = toRefs(props)
   // ä»…åœ¨éœ€è¦æ—¶è®¡ç®—
   const userInitials = computed(() => 
     name.value.split(' ').map(n => n[0]).join('')
   )
   ```

### è·¨ç»„ä»¶çŠ¶æ€å…±äº«

**è·¨ç»„ä»¶çŠ¶æ€å…±äº«å®ç°æ–¹å¼**:

1ã€ä½¿ç”¨ `provide/inject` å®ç°çˆ¶å­ç»„ä»¶é€šä¿¡,é€‚ç”¨äºè·¨å¤šå±‚ç»„ä»¶ä¼ é€’æ•°æ®

```ts
   // ä½¿ç”¨ provide/inject
   // çˆ¶ç»„ä»¶ä¸­æä¾›æ•°æ®
   const theme = ref('light')
   const updateTheme = (newTheme: string) => {
     theme.value = newTheme
   }
   // ä½¿ç”¨ Symbol ä½œä¸º key,é¿å…å‘½åå†²çª
   const themeKey = Symbol('theme')
   provide(themeKey, {
     theme,
     updateTheme
   })
   
   // å­ç»„ä»¶ä¸­æ³¨å…¥æ•°æ®
   const { theme, updateTheme } = inject(themeKey, {
     theme: ref('light'),
     updateTheme: () => {}
   })
```

2ã€ä½¿ç”¨ `composables` å®ç°å¯å¤ç”¨çš„çŠ¶æ€é€»è¾‘,æé«˜ä»£ç å¤ç”¨æ€§

```ts
   // ä½¿ç”¨ composables å°è£…å¯å¤ç”¨çš„çŠ¶æ€é€»è¾‘
   // composables/useCounter.ts
   export const useCounter = (initialValue = 0) => {
     // çŠ¶æ€
     const count = ref(initialValue)
     const doubleCount = computed(() => count.value * 2)
     
     // æ–¹æ³•
     const increment = (delta = 1) => {
       count.value += delta
     }
     const decrement = (delta = 1) => {
       count.value -= delta
     }
     const reset = () => {
       count.value = initialValue
     }

     // è¿”å›å“åº”å¼çŠ¶æ€å’Œæ–¹æ³•
     return {
       count: readonly(count), // åªè¯»å¼•ç”¨,é˜²æ­¢å¤–éƒ¨ç›´æ¥ä¿®æ”¹
       doubleCount,
       increment,
       decrement,
       reset
     }
   }
```

3ã€ä½¿ç”¨ `Pinia` è¿›è¡Œå…¨å±€çŠ¶æ€ç®¡ç†,é€‚ç”¨äºå¤æ‚çš„çŠ¶æ€ç®¡ç†åœºæ™¯

```ts
   // ä½¿ç”¨ Pinia Store è¿›è¡Œå…¨å±€çŠ¶æ€ç®¡ç†
   // stores/counter.ts
   interface CounterState {
     count: number
     history: number[]
   }

   export const useCounterStore = defineStore('counter', {
     // çŠ¶æ€
     state: (): CounterState => ({
       count: 0,
       history: []
     }),
     
     // è®¡ç®—å±æ€§
     getters: {
       doubleCount: (state) => state.count * 2,
       lastChange: (state) => {
         const last = state.history.at(-1)
         return last ?? 0
       }
     },
     
     // æ“ä½œæ–¹æ³•
     actions: {
       increment(delta = 1) {
         this.history.push(this.count)
         this.count += delta
       },
       async asyncIncrement(delta = 1) {
         await someAsyncOperation()
         this.increment(delta)
       },
       reset() {
         this.count = 0
         this.history = []
       }
     }
   })
   ```
   

   **æœ€ä½³å®è·µå»ºè®®**:
   - å¯¹äºçˆ¶å­ç»„ä»¶é€šä¿¡,ä¼˜å…ˆä½¿ç”¨ Props å’Œ Emits
   - å¯¹äºè·¨å¤šå±‚ç»„ä»¶é€šä¿¡,ä½¿ç”¨ provide/inject
   - å¯¹äºå¯å¤ç”¨çš„çŠ¶æ€é€»è¾‘,æŠ½å–ä¸º composables
   - å¯¹äºå…¨å±€çŠ¶æ€ç®¡ç†,ä½¿ç”¨ Pinia Store
   - é¿å…è¿‡åº¦ä½¿ç”¨å…¨å±€çŠ¶æ€,ä¼˜å…ˆè€ƒè™‘ç»„ä»¶çº§åˆ«çš„çŠ¶æ€ç®¡ç†


### çŠ¶æ€æŒä¹…åŒ–

çŠ¶æ€æŒä¹…åŒ–æ˜¯ç¡®ä¿åº”ç”¨çŠ¶æ€åœ¨é¡µé¢åˆ·æ–°æˆ–é‡æ–°åŠ è½½åä»ç„¶ä¿æŒçš„é‡è¦æŠ€æœ¯ã€‚ä»¥ä¸‹æ˜¯å¸¸è§çš„å®ç°æ–¹å¼ï¼š

1. **LocalStorage/SessionStorage**:
   - é€‚åˆå­˜å‚¨ä¸­å°å‹æ•°æ®
   - æ•°æ®æŒä¹…åŒ–åˆ°æµè§ˆå™¨
   - æœ€å¤§å­˜å‚¨å®¹é‡çº¦5MB
   - ç¤ºä¾‹ï¼šç”¨æˆ·åå¥½è®¾ç½®ã€è¡¨å•è‰ç¨¿
     ```typescript
     // å­˜å‚¨æ•°æ®
     localStorage.setItem('userPreferences', JSON.stringify(preferences));
     // è¯»å–æ•°æ®
     const preferences = JSON.parse(localStorage.getItem('userPreferences') || '{}');
     ```

2. **Cookies**:
   - é€‚åˆå­˜å‚¨å°å‹æ•°æ®
   - è‡ªåŠ¨éšè¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨
   - æœ€å¤§å­˜å‚¨çº¦4KB
   - ç¤ºä¾‹ï¼šç”¨æˆ·è®¤è¯ä¿¡æ¯ã€ä¼šè¯ID
     ```typescript
     // è®¾ç½® cookie
     document.cookie = "sessionId=abc123; path=/; max-age=3600";
     // è¯»å– cookie
     const cookies = document.cookie.split('; ').reduce((acc, cookie) => {
       const [key, value] = cookie.split('=');
       acc[key] = value;
       return acc;
     }, {} as Record<string, string>);
     ```

3. **IndexedDB**:
   - é€‚åˆå­˜å‚¨å¤§å‹ç»“æ„åŒ–æ•°æ®
   - æ”¯æŒäº‹åŠ¡æ“ä½œ
   - å­˜å‚¨å®¹é‡å¤§ï¼ˆé€šå¸¸50MBä»¥ä¸Šï¼‰
   - ç¤ºä¾‹ï¼šç¦»çº¿åº”ç”¨æ•°æ®ã€ç¼“å­˜èµ„æº
     ```typescript
     // æ‰“å¼€æ•°æ®åº“
     const request = indexedDB.open('myDatabase', 1);
     request.onupgradeneeded = (event) => {
       const db = (event.target as IDBOpenDBRequest).result;
       db.createObjectStore('offlineData', { keyPath: 'id' });
     };
     // å­˜å‚¨æ•°æ®
     request.onsuccess = (event) => {
       const db = (event.target as IDBOpenDBRequest).result;
       const transaction = db.transaction('offlineData', 'readwrite');
       const store = transaction.objectStore('offlineData');
       store.put({ id: 1, data: 'someData' });
     };
     ```

4. **Server-Side Storage**:
   - æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯
   - é€šè¿‡APIè¿›è¡Œæ•°æ®åŒæ­¥
   - é€‚åˆæ•æ„Ÿæ•°æ®å­˜å‚¨
   - ç¤ºä¾‹ï¼šç”¨æˆ·é…ç½®ã€åº”ç”¨çŠ¶æ€
     ```typescript
     // ä½¿ç”¨ fetch API åŒæ­¥æ•°æ®
     fetch('/api/saveUserConfig', {
       method: 'POST',
       headers: {
         'Content-Type': 'application/json'
       },
       body: JSON.stringify({ config: userConfig })
     });
     ```

5. **Nuxt.js å†…ç½®æ”¯æŒ**:
   - ä½¿ç”¨ `useCookie` è¿›è¡Œ cookie ç®¡ç†
   - ä½¿ç”¨ `useStorage` è¿›è¡Œ localStorage/sessionStorage ç®¡ç†
   - æ”¯æŒ SSR åœºæ™¯ä¸‹çš„çŠ¶æ€åŒæ­¥
     ```typescript
     import { useCookie, useStorage } from '#app';

     // ä½¿ç”¨ useCookie
     const sessionId = useCookie('sessionId');
     sessionId.value = 'abc123';

     // ä½¿ç”¨ useStorage
     const userPreferences = useStorage('userPreferences', { theme: 'dark' });
     ```

**å®ç°å»ºè®®**:
- æ ¹æ®æ•°æ®å¤§å°å’Œè®¿é—®é¢‘ç‡é€‰æ‹©åˆé€‚çš„å­˜å‚¨æ–¹å¼
- å¯¹æ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ å¯†å¤„ç†
- è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
- å¤„ç†å­˜å‚¨ç©ºé—´ä¸è¶³çš„æƒ…å†µ
- è€ƒè™‘è·¨æµè§ˆå™¨å…¼å®¹æ€§

## Layout å¸ƒå±€ç³»ç»Ÿ

Nuxt çš„å¸ƒå±€ç³»ç»Ÿæä¾›äº†çµæ´»çš„é¡µé¢ç»“æ„ç®¡ç†æ–¹æ¡ˆï¼Œé€šè¿‡çº¦å®šå¼çš„æ–‡ä»¶ç»“æ„å’Œå£°æ˜å¼çš„å¸ƒå±€åˆ‡æ¢æœºåˆ¶ï¼Œå®ç°äº†é«˜æ•ˆçš„é¡µé¢æ¨¡æ¿ç®¡ç†ã€‚å¸ƒå±€ç³»ç»Ÿä¸ä»…ç®€åŒ–äº†é‡å¤ç»“æ„çš„ç»´æŠ¤ï¼Œè¿˜æ”¯æŒåŠ¨æ€åˆ‡æ¢ã€åµŒå¥—å¸ƒå±€ç­‰é«˜çº§ç‰¹æ€§ã€‚

### å¸ƒå±€ç³»ç»Ÿå·¥ä½œåŸç†

#### æ ¸å¿ƒæ¦‚å¿µ

å¸ƒå±€ç³»ç»Ÿæ˜¯åŸºäº Vue.js çš„æ’æ§½æœºåˆ¶å’Œ Nuxt çš„æ–‡ä»¶çº¦å®šå®ç°çš„é¡µé¢æ¨¡æ¿ç®¡ç†ç³»ç»Ÿã€‚å®ƒçš„æ ¸å¿ƒå·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š

::alert{icon="lucide:workflow" color="blue"}
**å·¥ä½œæµç¨‹**ï¼š
1. **å¸ƒå±€æ³¨å†Œ**: Nuxt æ‰«æ `layouts/` ç›®å½•ï¼Œè‡ªåŠ¨æ³¨å†Œæ‰€æœ‰å¸ƒå±€æ–‡ä»¶
2. **å¸ƒå±€é€‰æ‹©**: é¡µé¢ç»„ä»¶é€šè¿‡ `definePageMeta` æˆ–åŠ¨æ€æ–¹å¼æŒ‡å®šå¸ƒå±€
3. **å¸ƒå±€æ¸²æŸ“**: Nuxt å°†é¡µé¢å†…å®¹æ¸²æŸ“åˆ°å¸ƒå±€çš„ `<slot>` ä½ç½®
4. **çŠ¶æ€åŒæ­¥**: å¸ƒå±€é—´åˆ‡æ¢æ—¶ä¿æŒåº”ç”¨çŠ¶æ€çš„è¿ç»­æ€§
::

#### æ–‡ä»¶ç»“æ„çº¦å®š

```
layouts/
â”œâ”€â”€ default.vue          # é»˜è®¤å¸ƒå±€
â”œâ”€â”€ admin.vue           # ç®¡ç†åå°å¸ƒå±€
â”œâ”€â”€ auth.vue            # è®¤è¯é¡µé¢å¸ƒå±€
â”œâ”€â”€ blog.vue            # åšå®¢é¡µé¢å¸ƒå±€
â”œâ”€â”€ landing.vue         # è½åœ°é¡µå¸ƒå±€
â””â”€â”€ error.vue           # é”™è¯¯é¡µé¢å¸ƒå±€
```

### åŸºç¡€å¸ƒå±€å®ç°

#### é»˜è®¤å¸ƒå±€è®¾è®¡

é»˜è®¤å¸ƒå±€æ˜¯æ•´ä¸ªåº”ç”¨çš„åŸºç¡€æ¨¡æ¿ï¼Œæ‰¿è½½äº†é€šç”¨çš„é¡µé¢ç»“æ„ï¼š

```vue
<!-- layouts/default.vue -->
<template>
  <div class="app-layout">
    <!-- åº”ç”¨å¤´éƒ¨ -->
    <AppHeader 
      :user="user"
      :navigation="navigation"
      @toggle-sidebar="handleSidebarToggle"
    />
    
    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="app-main" :class="mainClasses">
      <!-- ä¾§è¾¹æ  -->
      <AppSidebar 
        v-if="showSidebar"
        :collapsed="sidebarCollapsed"
        :navigation="sidebarNavigation"
        @navigate="handleNavigation"
      />
      
      <!-- é¡µé¢å†…å®¹ -->
      <main class="app-content" :class="contentClasses">
        <!-- é¢åŒ…å±‘å¯¼èˆª -->
        <AppBreadcrumb 
          v-if="showBreadcrumb" 
          :items="breadcrumbItems" 
        />
        
        <!-- é¡µé¢æ’æ§½ - è¿™é‡Œæ¸²æŸ“å…·ä½“é¡µé¢å†…å®¹ -->
        <slot />
        
        <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
        <BackToTop v-if="showBackToTop" />
      </main>
    </div>
    
    <!-- åº”ç”¨åº•éƒ¨ -->
    <AppFooter 
      v-if="showFooter"
      :links="footerLinks"
      :social="socialLinks"
    />
    
    <!-- å…¨å±€ç»„ä»¶ -->
    <Toaster />
    <GlobalModal />
    <LoadingIndicator />
  </div>
</template>

<script setup lang="ts">
interface LayoutConfig {
  showSidebar: boolean
  showBreadcrumb: boolean
  showFooter: boolean
  showBackToTop: boolean
  sidebarCollapsed: boolean
}

// å¸ƒå±€çŠ¶æ€ç®¡ç†
const layoutStore = useLayoutStore()
const { user } = useAuthStore()
const route = useRoute()

// å“åº”å¼å¸ƒå±€é…ç½®
const layoutConfig = computed((): LayoutConfig => {
  return {
    showSidebar: !route.meta.hideSidebar,
    showBreadcrumb: !route.meta.hideBreadcrumb,
    showFooter: !route.meta.hideFooter,
    showBackToTop: true,
    sidebarCollapsed: layoutStore.sidebarCollapsed
  }
})

// å¯¼èˆªæ•°æ®
const navigation = computed(() => layoutStore.navigation)
const sidebarNavigation = computed(() => layoutStore.sidebarNavigation)
const breadcrumbItems = computed(() => layoutStore.breadcrumbItems)

// æ ·å¼ç±»è®¡ç®—
const mainClasses = computed(() => [
  'app-main',
  {
    'app-main--with-sidebar': layoutConfig.value.showSidebar,
    'app-main--sidebar-collapsed': layoutConfig.value.sidebarCollapsed
  }
])

const contentClasses = computed(() => [
  'app-content',
  {
    'app-content--with-breadcrumb': layoutConfig.value.showBreadcrumb
  }
])

// äº‹ä»¶å¤„ç†
const handleSidebarToggle = () => {
  layoutStore.toggleSidebar()
}

const handleNavigation = (path: string) => {
  navigateTo(path)
}

// é“¾æ¥æ•°æ®
const footerLinks = [
  { label: 'å…³äºæˆ‘ä»¬', href: '/about' },
  { label: 'è”ç³»æˆ‘ä»¬', href: '/contact' },
  { label: 'éšç§æ”¿ç­–', href: '/privacy' }
]

const socialLinks = [
  { platform: 'github', url: 'https://github.com/example' },
  { platform: 'twitter', url: 'https://twitter.com/example' }
]
</script>

<style scoped>
.app-layout {
  @apply min-h-screen flex flex-col;
}

.app-main {
  @apply flex-1 flex;
  
  &--with-sidebar {
    @apply pl-64;
  }
  
  &--sidebar-collapsed {
    @apply pl-16;
  }
}

.app-content {
  @apply flex-1 p-6;
  
  &--with-breadcrumb {
    @apply pt-12;
  }
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .app-main--with-sidebar {
    @apply pl-0;
  }
}
</style>
```

#### ç‰¹å®šåœºæ™¯å¸ƒå±€

é’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œåˆ›å»ºä¸“ç”¨çš„å¸ƒå±€æ¨¡æ¿ï¼š

::code-group
  ::::code-block{label="ç®¡ç†åå°å¸ƒå±€" language="vue"}
  ```vue
  <!-- layouts/admin.vue -->
  <template>
    <div class="admin-layout">
      <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
      <AdminHeader 
        :user="currentUser"
        :notifications="notifications"
        @logout="handleLogout"
      />
      
      <div class="admin-main">
        <!-- ä¾§è¾¹å¯¼èˆª -->
        <AdminSidebar 
          :menu="adminMenu"
          :permissions="userPermissions"
          :collapsed="sidebarCollapsed"
          @menu-select="handleMenuSelect"
        />
        
        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="admin-content">
          <!-- é¡µé¢å¤´éƒ¨ -->
          <div class="admin-content-header">
            <AdminBreadcrumb :items="breadcrumbs" />
            <AdminToolbar :actions="pageActions" />
          </div>
          
          <!-- é¡µé¢ä¸»ä½“ -->
          <div class="admin-content-body">
            <slot />
          </div>
        </div>
      </div>
      
      <!-- æƒé™éªŒè¯ç»„ä»¶ -->
      <PermissionGuard />
    </div>
  </template>

  <script setup lang="ts">
  // æƒé™éªŒè¯
  definePageMeta({
    middleware: ['auth', 'admin']
  })

  const { currentUser, userPermissions } = useAuth()
  const adminStore = useAdminStore()
  
  const adminMenu = computed(() => adminStore.menu)
  const notifications = computed(() => adminStore.notifications)
  const breadcrumbs = computed(() => adminStore.breadcrumbs)
  const pageActions = computed(() => adminStore.pageActions)
  
  const sidebarCollapsed = ref(false)
  
  const handleLogout = async () => {
    await $auth.logout()
    await navigateTo('/login')
  }
  
  const handleMenuSelect = (menuItem: AdminMenuItem) => {
    navigateTo(menuItem.path)
  }
  </script>
  ```
  ::::

  ::::code-block{label="è®¤è¯é¡µé¢å¸ƒå±€" language="vue"}
  ```vue
  <!-- layouts/auth.vue -->
  <template>
    <div class="auth-layout">
      <!-- èƒŒæ™¯è£…é¥° -->
      <div class="auth-background">
        <div class="auth-background-pattern"></div>
        <div class="auth-background-gradient"></div>
      </div>
      
      <!-- è®¤è¯å†…å®¹ -->
      <div class="auth-content">
        <!-- å“ç‰ŒåŒºåŸŸ -->
        <div class="auth-brand">
          <NuxtLink to="/" class="auth-logo">
            <img src="/logo.svg" alt="Logo" />
            <span class="auth-brand-text">Your App</span>
          </NuxtLink>
        </div>
        
        <!-- è®¤è¯è¡¨å•åŒºåŸŸ -->
        <div class="auth-form-container">
          <slot />
        </div>
        
        <!-- é¡µè„šé“¾æ¥ -->
        <div class="auth-footer">
          <NuxtLink to="/privacy">éšç§æ”¿ç­–</NuxtLink>
          <NuxtLink to="/terms">æœåŠ¡æ¡æ¬¾</NuxtLink>
          <NuxtLink to="/help">å¸®åŠ©ä¸­å¿ƒ</NuxtLink>
        </div>
      </div>
      
      <!-- ä¸»é¢˜åˆ‡æ¢ -->
      <ThemeToggle class="auth-theme-toggle" />
    </div>
  </template>

  <script setup lang="ts">
  // è®¤è¯é¡µé¢ä¸éœ€è¦ç”¨æˆ·ç™»å½•
  definePageMeta({
    layout: 'auth',
    auth: false
  })
  
  // SEO ä¼˜åŒ–
  useSeoMeta({
    title: 'ç”¨æˆ·ç™»å½• - Your App',
    description: 'ç™»å½•æ‚¨çš„è´¦æˆ·ä»¥è®¿é—®ä¸ªæ€§åŒ–å†…å®¹å’ŒæœåŠ¡'
  })
  </script>

  <style scoped>
  .auth-layout {
    @apply min-h-screen relative flex items-center justify-center p-4;
  }
  
  .auth-background {
    @apply absolute inset-0 overflow-hidden;
  }
  
  .auth-content {
    @apply relative z-10 w-full max-w-md;
  }
  
  .auth-brand {
    @apply text-center mb-8;
  }
  
  .auth-logo {
    @apply inline-flex items-center space-x-2 text-2xl font-bold;
  }
  
  .auth-form-container {
    @apply bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8;
  }
  
  .auth-footer {
    @apply mt-6 text-center space-x-4 text-sm text-gray-600;
  }
  
  .auth-theme-toggle {
    @apply absolute top-4 right-4;
  }
  </style>
  ```
  ::::
::

### åŠ¨æ€å¸ƒå±€åˆ‡æ¢

#### é¡µé¢çº§å¸ƒå±€æŒ‡å®š

é€šè¿‡ `definePageMeta` ä¸ºç‰¹å®šé¡µé¢æŒ‡å®šå¸ƒå±€ï¼š

```vue
<!-- pages/admin/dashboard.vue -->
<script setup lang="ts">
// é™æ€å¸ƒå±€æŒ‡å®š
definePageMeta({
  layout: 'admin'
})
</script>

<template>
  <div class="dashboard">
    <h1>ç®¡ç†å‘˜ä»ªè¡¨æ¿</h1>
    <!-- é¡µé¢å†…å®¹ -->
  </div>
</template>
```

#### è¿è¡Œæ—¶å¸ƒå±€åˆ‡æ¢

åœ¨ç‰¹å®šæ¡ä»¶ä¸‹åŠ¨æ€åˆ‡æ¢å¸ƒå±€ï¼š

```vue
<!-- pages/app.vue -->
<script setup lang="ts">
const { user } = useAuth()
const route = useRoute()

// åŠ¨æ€å¸ƒå±€é€‰æ‹©
const currentLayout = computed(() => {
  // æ ¹æ®ç”¨æˆ·è§’è‰²é€‰æ‹©å¸ƒå±€
  if (user.value?.role === 'admin') {
    return 'admin'
  }
  
  // æ ¹æ®è·¯ç”±è·¯å¾„é€‰æ‹©å¸ƒå±€
  if (route.path.startsWith('/auth')) {
    return 'auth'
  }
  
  // æ ¹æ®è®¾å¤‡ç±»å‹é€‰æ‹©å¸ƒå±€
  if (process.client && window.innerWidth < 768) {
    return 'mobile'
  }
  
  return 'default'
})

// åº”ç”¨å¸ƒå±€
setPageLayout(currentLayout.value)

// ç›‘å¬å¸ƒå±€å˜åŒ–
watch(currentLayout, (newLayout) => {
  setPageLayout(newLayout)
})
</script>
```

#### æ¡ä»¶å¸ƒå±€æ¸²æŸ“

åŸºäºå¤æ‚ä¸šåŠ¡é€»è¾‘çš„å¸ƒå±€åˆ‡æ¢ï¼š

```typescript
// composables/useLayoutSelector.ts
export const useLayoutSelector = () => {
  const { user } = useAuth()
  const { device } = useDevice()
  const route = useRoute()
  
  const getLayoutForRoute = (path: string): string => {
    const layoutMap = {
      '/admin': 'admin',
      '/auth': 'auth',
      '/blog': 'blog',
      '/landing': 'landing'
    }
    
    // ç²¾ç¡®åŒ¹é…
    if (layoutMap[path]) {
      return layoutMap[path]
    }
    
    // å‰ç¼€åŒ¹é…
    for (const [prefix, layout] of Object.entries(layoutMap)) {
      if (path.startsWith(prefix)) {
        return layout
      }
    }
    
    return 'default'
  }
  
  const getLayoutForUser = (): string => {
    if (!user.value) return 'auth'
    
    switch (user.value.role) {
      case 'admin':
        return 'admin'
      case 'premium':
        return 'premium'
      default:
        return 'default'
    }
  }
  
  const getLayoutForDevice = (): string => {
    return device.isMobile ? 'mobile' : 'desktop'
  }
  
  const selectLayout = (): string => {
    // ä¼˜å…ˆçº§ï¼šè·¯ç”± > ç”¨æˆ·è§’è‰² > è®¾å¤‡ç±»å‹
    const routeLayout = getLayoutForRoute(route.path)
    
    if (routeLayout !== 'default') {
      return routeLayout
    }
    
    const userLayout = getLayoutForUser()
    if (userLayout !== 'default') {
      return userLayout
    }
    
    return getLayoutForDevice()
  }
  
  return {
    selectLayout,
    getLayoutForRoute,
    getLayoutForUser,
    getLayoutForDevice
  }
}
```

### åµŒå¥—å¸ƒå±€ç³»ç»Ÿ

#### å¤šå±‚çº§å¸ƒå±€ç»“æ„

å¯¹äºå¤æ‚åº”ç”¨ï¼Œå¯èƒ½éœ€è¦å¤šå±‚åµŒå¥—çš„å¸ƒå±€ç»“æ„ï¼š

```vue
<!-- layouts/admin.vue - ä¸€çº§å¸ƒå±€ -->
<template>
  <div class="admin-layout">
    <AdminHeader />
    <div class="admin-body">
      <AdminSidebar />
      <div class="admin-content">
        <!-- æ¸²æŸ“å­å¸ƒå±€æˆ–é¡µé¢å†…å®¹ -->
        <slot />
      </div>
    </div>
  </div>
</template>
```

```vue
<!-- layouts/admin/dashboard.vue - äºŒçº§å¸ƒå±€ -->
<template>
  <div class="dashboard-layout">
    <!-- ä»ªè¡¨æ¿ç‰¹å®šçš„å¤´éƒ¨ -->
    <DashboardHeader :widgets="widgets" />
    
    <!-- ä»ªè¡¨æ¿ç½‘æ ¼ç³»ç»Ÿ -->
    <div class="dashboard-grid">
      <aside class="dashboard-sidebar">
        <DashboardSidebar :modules="modules" />
      </aside>
      
      <main class="dashboard-main">
        <!-- æ¸²æŸ“å…·ä½“çš„ä»ªè¡¨æ¿é¡µé¢ -->
        <slot />
      </main>
    </div>
  </div>
</template>

<script setup lang="ts">
// ç»§æ‰¿çˆ¶çº§å¸ƒå±€
definePageMeta({
  layout: 'admin'
})

const dashboardStore = useDashboardStore()
const widgets = computed(() => dashboardStore.widgets)
const modules = computed(() => dashboardStore.modules)
</script>
```

#### å¸ƒå±€ç»„åˆæ¨¡å¼

ä½¿ç”¨ç»„åˆæ¨¡å¼åˆ›å»ºå¯å¤ç”¨çš„å¸ƒå±€ç‰‡æ®µï¼š

```typescript
// composables/useLayoutComposition.ts
interface LayoutComposition {
  header?: Component
  sidebar?: Component
  footer?: Component
  toolbar?: Component
}

export const useLayoutComposition = () => {
  const composeLayout = (composition: LayoutComposition) => {
    return {
      components: {
        LayoutHeader: composition.header || DefaultHeader,
        LayoutSidebar: composition.sidebar || DefaultSidebar,
        LayoutFooter: composition.footer || DefaultFooter,
        LayoutToolbar: composition.toolbar || DefaultToolbar
      }
    }
  }
  
  const adminComposition: LayoutComposition = {
    header: AdminHeader,
    sidebar: AdminSidebar,
    footer: AdminFooter,
    toolbar: AdminToolbar
  }
  
  const blogComposition: LayoutComposition = {
    header: BlogHeader,
    sidebar: BlogSidebar,
    footer: BlogFooter
  }
  
  return {
    composeLayout,
    adminComposition,
    blogComposition
  }
}
```

### å¸ƒå±€çŠ¶æ€ç®¡ç†

#### å¸ƒå±€çŠ¶æ€ Store

ä½¿ç”¨ Pinia ç®¡ç†å¸ƒå±€çš„å…¨å±€çŠ¶æ€ï¼š

```typescript
// stores/layout.ts
interface LayoutState {
  currentLayout: string
  sidebarCollapsed: boolean
  headerHeight: number
  footerHeight: number
  navigation: NavigationItem[]
  breadcrumbs: BreadcrumbItem[]
  notifications: Notification[]
}

interface NavigationItem {
  id: string
  label: string
  href: string
  icon?: string
  children?: NavigationItem[]
  permissions?: string[]
}

interface BreadcrumbItem {
  label: string
  href?: string
  active: boolean
}

export const useLayoutStore = defineStore('layout', {
  state: (): LayoutState => ({
    currentLayout: 'default',
    sidebarCollapsed: false,
    headerHeight: 64,
    footerHeight: 80,
    navigation: [],
    breadcrumbs: [],
    notifications: []
  }),
  
  getters: {
    // è®¡ç®—å†…å®¹åŒºåŸŸé«˜åº¦
    contentHeight: (state) => {
      if (process.client) {
        return window.innerHeight - state.headerHeight - state.footerHeight
      }
      return 600 // SSR é»˜è®¤å€¼
    },
    
    // è·å–å½“å‰å¯¼èˆªé¡¹
    activeNavigation: (state) => {
      const route = useRoute()
      return state.navigation.find(item => 
        route.path.startsWith(item.href)
      )
    },
    
    // è¿‡æ»¤æœ‰æƒé™çš„å¯¼èˆªé¡¹
    authorizedNavigation: (state) => {
      const { user } = useAuth()
      return state.navigation.filter(item => {
        if (!item.permissions) return true
        return item.permissions.some(permission => 
          user.value?.permissions.includes(permission)
        )
      })
    }
  },
  
  actions: {
    // è®¾ç½®å½“å‰å¸ƒå±€
    setLayout(layout: string) {
      this.currentLayout = layout
    },
    
    // åˆ‡æ¢ä¾§è¾¹æ çŠ¶æ€
    toggleSidebar() {
      this.sidebarCollapsed = !this.sidebarCollapsed
      
      // æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨
      if (process.client) {
        localStorage.setItem('sidebarCollapsed', String(this.sidebarCollapsed))
      }
    },
    
    // è®¾ç½®å¯¼èˆªæ•°æ®
    setNavigation(navigation: NavigationItem[]) {
      this.navigation = navigation
    },
    
    // æ›´æ–°é¢åŒ…å±‘
    updateBreadcrumbs(route: RouteLocationNormalized) {
      const breadcrumbs: BreadcrumbItem[] = []
      const pathArray = route.path.split('/').filter(Boolean)
      
      let currentPath = ''
      pathArray.forEach((segment, index) => {
        currentPath += `/${segment}`
        breadcrumbs.push({
          label: this.getSegmentLabel(segment),
          href: index === pathArray.length - 1 ? undefined : currentPath,
          active: index === pathArray.length - 1
        })
      })
      
      this.breadcrumbs = breadcrumbs
    },
    
    // æ·»åŠ é€šçŸ¥
    addNotification(notification: Omit<Notification, 'id' | 'timestamp'>) {
      const newNotification: Notification = {
        ...notification,
        id: generateId(),
        timestamp: Date.now()
      }
      this.notifications.unshift(newNotification)
      
      // é™åˆ¶é€šçŸ¥æ•°é‡
      if (this.notifications.length > 50) {
        this.notifications = this.notifications.slice(0, 50)
      }
    },
    
    // ç§»é™¤é€šçŸ¥
    removeNotification(id: string) {
      const index = this.notifications.findIndex(n => n.id === id)
      if (index > -1) {
        this.notifications.splice(index, 1)
      }
    },
    
    // è·å–è·¯å¾„æ®µæ ‡ç­¾
    getSegmentLabel(segment: string): string {
      const labelMap: Record<string, string> = {
        'admin': 'ç®¡ç†åå°',
        'dashboard': 'ä»ªè¡¨æ¿',
        'users': 'ç”¨æˆ·ç®¡ç†',
        'products': 'äº§å“ç®¡ç†',
        'orders': 'è®¢å•ç®¡ç†',
        'settings': 'ç³»ç»Ÿè®¾ç½®'
      }
      
      return labelMap[segment] || segment.charAt(0).toUpperCase() + segment.slice(1)
    }
  }
})
```

#### å“åº”å¼å¸ƒå±€é€‚é…

æ ¹æ®å±å¹•å°ºå¯¸è‡ªåŠ¨è°ƒæ•´å¸ƒå±€ï¼š

```typescript
// composables/useResponsiveLayout.ts
export const useResponsiveLayout = () => {
  const layoutStore = useLayoutStore()
  const windowSize = useWindowSize()
  
  // æ–­ç‚¹å®šä¹‰
  const breakpoints = {
    sm: 640,
    md: 768,
    lg: 1024,
    xl: 1280,
    '2xl': 1536
  }
  
  // å½“å‰æ–­ç‚¹
  const currentBreakpoint = computed(() => {
    const width = windowSize.width.value
    
    if (width >= breakpoints['2xl']) return '2xl'
    if (width >= breakpoints.xl) return 'xl'
    if (width >= breakpoints.lg) return 'lg'
    if (width >= breakpoints.md) return 'md'
    if (width >= breakpoints.sm) return 'sm'
    return 'xs'
  })
  
  // æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
  const isMobile = computed(() => 
    windowSize.width.value < breakpoints.md
  )
  
  // æ˜¯å¦ä¸ºå¹³æ¿è®¾å¤‡
  const isTablet = computed(() => 
    windowSize.width.value >= breakpoints.md && 
    windowSize.width.value < breakpoints.lg
  )
  
  // æ˜¯å¦ä¸ºæ¡Œé¢è®¾å¤‡
  const isDesktop = computed(() => 
    windowSize.width.value >= breakpoints.lg
  )
  
  // å“åº”å¼å¸ƒå±€é…ç½®
  const responsiveConfig = computed(() => ({
    sidebarCollapsed: isMobile.value || layoutStore.sidebarCollapsed,
    showMobileNav: isMobile.value,
    headerHeight: isMobile.value ? 56 : 64,
    sidebarWidth: isMobile.value ? 280 : isTablet.value ? 240 : 280,
    contentPadding: isMobile.value ? 16 : 24
  }))
  
  // ç›‘å¬å±å¹•å°ºå¯¸å˜åŒ–
  watch(isMobile, (mobile) => {
    if (mobile && !layoutStore.sidebarCollapsed) {
      layoutStore.toggleSidebar()
    }
  })
  
  return {
    windowSize,
    currentBreakpoint,
    isMobile,
    isTablet,
    isDesktop,
    responsiveConfig,
    breakpoints
  }
}
```

### å¸ƒå±€æ€§èƒ½ä¼˜åŒ–

#### å¸ƒå±€ç»„ä»¶æ‡’åŠ è½½

å¯¹äºå¤§å‹å¸ƒå±€ç»„ä»¶ï¼Œä½¿ç”¨æ‡’åŠ è½½æå‡æ€§èƒ½ï¼š

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  components: [
    {
      path: '~/components/layout',
      prefix: 'Layout',
      // å¯ç”¨å¸ƒå±€ç»„ä»¶æ‡’åŠ è½½
      lazy: true
    }
  ]
})
```

```vue
<!-- layouts/admin.vue -->
<script setup lang="ts">
// æ‡’åŠ è½½å¤æ‚ç»„ä»¶
const AdminDashboard = defineAsyncComponent(() => 
  import('~/components/admin/AdminDashboard.vue')
)

const AdminDataTable = defineAsyncComponent({
  loader: () => import('~/components/admin/AdminDataTable.vue'),
  loadingComponent: AdminTableSkeleton,
  errorComponent: AdminTableError,
  delay: 200,
  timeout: 5000
})
</script>
```

#### å¸ƒå±€çŠ¶æ€ç¼“å­˜

ç¼“å­˜å¸ƒå±€çŠ¶æ€å‡å°‘é‡å¤è®¡ç®—ï¼š

```typescript
// composables/useLayoutCache.ts
export const useLayoutCache = () => {
  const cache = new Map<string, any>()
  
  const getCachedLayout = (key: string) => {
    return cache.get(key)
  }
  
  const setCachedLayout = (key: string, layout: any) => {
    cache.set(key, layout)
    
    // é™åˆ¶ç¼“å­˜å¤§å°
    if (cache.size > 50) {
      const firstKey = cache.keys().next().value
      cache.delete(firstKey)
    }
  }
  
  const clearLayoutCache = () => {
    cache.clear()
  }
  
  return {
    getCachedLayout,
    setCachedLayout,
    clearLayoutCache
  }
}
```

#### è™šæ‹Ÿæ»šåŠ¨å¸ƒå±€

å¯¹äºåŒ…å«å¤§é‡æ•°æ®çš„å¸ƒå±€ï¼Œä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼š

```vue
<!-- components/layout/VirtualScrollLayout.vue -->
<template>
  <div class="virtual-scroll-layout" ref="container">
    <div 
      class="virtual-scroll-content"
      :style="{ height: `${totalHeight}px` }"
    >
      <div
        v-for="item in visibleItems"
        :key="item.id"
        :style="{
          position: 'absolute',
          top: `${item.top}px`,
          height: `${itemHeight}px`
        }"
        class="virtual-scroll-item"
      >
        <slot :item="item" :index="item.index" />
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
interface VirtualScrollItem {
  id: string | number
  index: number
  top: number
  data: any
}

interface Props {
  items: any[]
  itemHeight: number
  containerHeight: number
  buffer?: number
}

const props = withDefaults(defineProps<Props>(), {
  buffer: 5
})

const container = ref<HTMLElement>()
const scrollTop = ref(0)

// è®¡ç®—æ€»é«˜åº¦
const totalHeight = computed(() => 
  props.items.length * props.itemHeight
)

// è®¡ç®—å¯è§é¡¹ç›®
const visibleItems = computed((): VirtualScrollItem[] => {
  const containerHeight = props.containerHeight
  const itemHeight = props.itemHeight
  const buffer = props.buffer
  
  const startIndex = Math.max(0, 
    Math.floor(scrollTop.value / itemHeight) - buffer
  )
  const endIndex = Math.min(props.items.length - 1,
    Math.ceil((scrollTop.value + containerHeight) / itemHeight) + buffer
  )
  
  const visibleItems: VirtualScrollItem[] = []
  
  for (let i = startIndex; i <= endIndex; i++) {
    visibleItems.push({
      id: props.items[i].id || i,
      index: i,
      top: i * itemHeight,
      data: props.items[i]
    })
  }
  
  return visibleItems
})

// ç›‘å¬æ»šåŠ¨äº‹ä»¶
const handleScroll = (event: Event) => {
  const target = event.target as HTMLElement
  scrollTop.value = target.scrollTop
}

onMounted(() => {
  container.value?.addEventListener('scroll', handleScroll, { passive: true })
})

onUnmounted(() => {
  container.value?.removeEventListener('scroll', handleScroll)
})
</script>
```

### å¸ƒå±€æµ‹è¯•ç­–ç•¥

#### å•å…ƒæµ‹è¯•

æµ‹è¯•å¸ƒå±€ç»„ä»¶çš„åŸºæœ¬åŠŸèƒ½ï¼š

```typescript
// tests/layouts/default.test.ts
import { describe, it, expect, vi } from 'vitest'
import { mount } from '@vue/test-utils'
import DefaultLayout from '~/layouts/default.vue'

describe('DefaultLayout', () => {
  it('åº”è¯¥æ­£ç¡®æ¸²æŸ“åŸºæœ¬ç»“æ„', () => {
    const wrapper = mount(DefaultLayout, {
      slots: {
        default: '<div>é¡µé¢å†…å®¹</div>'
      }
    })
    
    expect(wrapper.find('.app-layout').exists()).toBe(true)
    expect(wrapper.find('.app-header').exists()).toBe(true)
    expect(wrapper.find('.app-content').exists()).toBe(true)
    expect(wrapper.text()).toContain('é¡µé¢å†…å®¹')
  })
  
  it('åº”è¯¥å“åº”ä¾§è¾¹æ åˆ‡æ¢', async () => {
    const wrapper = mount(DefaultLayout)
    
    const toggleButton = wrapper.find('[data-testid="sidebar-toggle"]')
    await toggleButton.trigger('click')
    
    expect(wrapper.vm.sidebarCollapsed).toBe(true)
    expect(wrapper.classes()).toContain('sidebar-collapsed')
  })
})
```

#### é›†æˆæµ‹è¯•

æµ‹è¯•å¸ƒå±€ä¸é¡µé¢çš„é›†æˆï¼š

```typescript
// tests/integration/layout-integration.test.ts
import { describe, it, expect } from 'vitest'
import { createTestContext } from '~/tests/utils'

describe('å¸ƒå±€é›†æˆæµ‹è¯•', () => {
  it('åº”è¯¥æ ¹æ®è·¯ç”±æ­£ç¡®é€‰æ‹©å¸ƒå±€', async () => {
    const ctx = await createTestContext()
    
    // æµ‹è¯•ç®¡ç†å‘˜è·¯ç”±
    await ctx.router.push('/admin/dashboard')
    expect(ctx.app.$nuxt.layout).toBe('admin')
    
    // æµ‹è¯•è®¤è¯è·¯ç”±
    await ctx.router.push('/auth/login')
    expect(ctx.app.$nuxt.layout).toBe('auth')
    
    // æµ‹è¯•é»˜è®¤è·¯ç”±
    await ctx.router.push('/')
    expect(ctx.app.$nuxt.layout).toBe('default')
  })
})
```

### æœ€ä½³å®è·µæ€»ç»“

#### è®¾è®¡åŸåˆ™

1. **èŒè´£åˆ†ç¦»**: å¸ƒå±€ä¸“æ³¨äºé¡µé¢ç»“æ„ï¼Œé¡µé¢ä¸“æ³¨äºå†…å®¹é€»è¾‘
2. **å¯å¤ç”¨æ€§**: è®¾è®¡é€šç”¨çš„å¸ƒå±€ç»„ä»¶ï¼Œæ”¯æŒå¤šåœºæ™¯ä½¿ç”¨
3. **å“åº”å¼**: ç¡®ä¿å¸ƒå±€åœ¨ä¸åŒè®¾å¤‡ä¸Šçš„è‰¯å¥½è¡¨ç°
4. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨æ‡’åŠ è½½ã€ç¼“å­˜ç­‰æŠ€æœ¯ä¼˜åŒ–å¸ƒå±€æ€§èƒ½

#### å¼€å‘å»ºè®®

::alert{icon="lucide:lightbulb" color="green"}
**æ ¸å¿ƒå»ºè®®**ï¼š
- ä½¿ç”¨ TypeScript ç¡®ä¿å¸ƒå±€ç»„ä»¶çš„ç±»å‹å®‰å…¨
- åˆç†ä½¿ç”¨ Pinia ç®¡ç†å¸ƒå±€çŠ¶æ€ï¼Œé¿å… prop drilling
- å®ç°å¸ƒå±€çš„æ¸è¿›å¼åŠ è½½ï¼Œæå‡é¦–å±æ€§èƒ½
- ä¸ºå¸ƒå±€ç»„ä»¶ç¼–å†™å……åˆ†çš„æµ‹è¯•ç”¨ä¾‹
- è€ƒè™‘ SEO å› ç´ ï¼Œæ­£ç¡®è®¾ç½®é¡µé¢å…ƒä¿¡æ¯
::

é€šè¿‡ä»¥ä¸Šå¸ƒå±€ç³»ç»Ÿçš„è®¾è®¡å’Œå®ç°ï¼Œå¯ä»¥æ„å»ºå‡ºçµæ´»ã€é«˜æ•ˆã€å¯ç»´æŠ¤çš„ Nuxt åº”ç”¨å¸ƒå±€æ¶æ„ã€‚





## æ€»ç»“

æœ¬æ–‡æ·±å…¥æ¢è®¨äº† Nuxt æ¡†æ¶çš„ç»„ä»¶åŒ–å¼€å‘ä½“ç³»å’Œå¸ƒå±€ç³»ç»Ÿï¼Œæ¶µç›–äº†ä»åŸºç¡€çš„ç»„ä»¶è‡ªåŠ¨å¯¼å…¥åˆ°å¤æ‚çš„å¸ƒå±€åˆ‡æ¢ç­–ç•¥ã€‚é€šè¿‡å­¦ä¹ è¿™äº›å†…å®¹ï¼Œå¼€å‘è€…å¯ä»¥ï¼š

### æ ¸å¿ƒæ”¶è·

1. **æŒæ¡ç»„ä»¶ç³»ç»Ÿ**: ç†è§£ Nuxt ç»„ä»¶çš„è‡ªåŠ¨å¯¼å…¥æœºåˆ¶ã€å‘½åè§„èŒƒå’Œç›®å½•ç»“æ„è®¾è®¡
2. **ç»„ä»¶é€šä¿¡**: ç†Ÿç»ƒä½¿ç”¨ Propsã€Pinia å’Œ Composables è¿›è¡Œç»„ä»¶é—´é€šä¿¡
3. **å¸ƒå±€è®¾è®¡**: å­¦ä¼šåˆ›å»ºçµæ´»çš„å¸ƒå±€ç³»ç»Ÿï¼Œæ”¯æŒåŠ¨æ€åˆ‡æ¢å’ŒåµŒå¥—ç»“æ„
4. **æ€§èƒ½ä¼˜åŒ–**: æŒæ¡ç»„ä»¶å’Œå¸ƒå±€çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### æœ€ä½³å®è·µ

- åˆç†è§„åˆ’ç»„ä»¶ç›®å½•ç»“æ„ï¼Œé‡‡ç”¨åŸå­åŒ–è®¾è®¡æ€æƒ³
- ä½¿ç”¨ TypeScript ç¡®ä¿ç±»å‹å®‰å…¨
- æ³¨æ„ SSR å…¼å®¹æ€§ï¼Œæ­£ç¡®å¤„ç†å®¢æˆ·ç«¯ä¸“å±ç»„ä»¶
- å®ç°çŠ¶æ€æŒä¹…åŒ–ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- é‡‡ç”¨ç¼“å­˜å’Œæ‡’åŠ è½½ç­–ç•¥ä¼˜åŒ–æ€§èƒ½

é€šè¿‡è¿™äº›æŠ€æœ¯çš„ç»¼åˆè¿ç”¨ï¼Œå¯ä»¥æ„å»ºå‡ºé«˜è´¨é‡ã€é«˜æ€§èƒ½çš„ä¼ä¸šçº§ Nuxt åº”ç”¨ã€‚ 